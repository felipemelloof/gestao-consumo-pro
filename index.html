<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Churros Pro | Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { 
            --primario: #2d3436; 
            --accent: #6c5ce7;
            --sucesso: #00b894; 
            --perigo: #d63031; 
            --info: #0984e3;
            --glass: rgba(255, 255, 255, 0.9);
        }
        
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            min-height: 100vh;
            margin: 0; padding: 20px; color: #2d3436; 
        }
        
        .container { max-width: 1100px; margin: auto; }
        
        /* Mensagem Motivadora */
        .frase-box {
            background: var(--accent); color: white;
            padding: 15px; border-radius: 12px;
            text-align: center; margin-bottom: 25px;
            font-style: italic; font-weight: 500;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
        }

        header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 30px; background: var(--glass); padding: 20px;
            border-radius: 20px; backdrop-filter: blur(10px);
        }
        
        .resumo-dia { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        
        .card-lucro { 
            background: var(--glass); padding: 20px; border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .valor-card { font-size: 1.8rem; font-weight: 800; margin-top: 5px; }

        /* Grid Principal */
        .grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .painel { 
            background: var(--glass); padding: 25px; border-radius: 20px; 
            backdrop-filter: blur(10px); border: 1px solid white;
        }

        /* Gr√°ficos */
        .chart-container { height: 250px; margin-top: 20px; }

        input, select { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; 
            margin-bottom: 10px; box-sizing: border-box;
        }

        .btn { 
            width: 100%; padding: 14px; border: none; border-radius: 10px; 
            font-weight: 700; cursor: pointer; transition: 0.3s; margin-bottom: 5px;
        }
        .btn-lancar { background: var(--primario); color: white; }
        .btn-venda { background: var(--accent); color: white; }
        .btn-whats { background: var(--sucesso); color: white; }

        @media (max-width: 768px) { .grid-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container" id="conteudo-para-pdf">
    <div class="frase-box" id="frase-motivadora">"O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia."</div>

    <header>
        <div onclick="configurarNomeEmpresa()" style="cursor:pointer">
            <h1 id="nome-empresa" style="margin:0">Churros Pro</h1>
            <small>üìç Dashboard de Controle</small>
        </div>
        <div style="text-align:right">
            <span id="data-topo" style="display:block; font-size:0.8rem"></span>
            <span id="hora-topo" style="font-size:1.4rem; font-weight:bold; color:var(--accent)"></span>
        </div>
    </header>

    <div class="resumo-dia">
        <div class="card-lucro" style="border-top: 5px solid var(--info);">
            <small>VENDA BRUTA</small>
            <div id="venda-bruta" class="valor-card" style="color: var(--info);">R$ 0,00</div>
        </div>
        <div class="card-lucro" style="border-top: 5px solid var(--perigo);">
            <small>CUSTO TOTAL</small>
            <div id="custo-total" class="valor-card" style="color: var(--perigo);">R$ 0,00</div>
        </div>
        <div class="card-lucro" style="border-top: 5px solid var(--sucesso);">
            <small>LUCRO L√çQUIDO</small>
            <div id="lucro-real" class="valor-card" style="color: var(--sucesso);">R$ 0,00</div>
        </div>
    </div>

    <div class="grid-layout">
        <div class="painel">
            <h3>üì• Lan√ßamentos</h3>
            <label>Insumo:</label>
            <select id="u-insumo"></select>
            <input type="number" id="u-qtd" placeholder="Quantidade usada">
            <button class="btn btn-lancar" onclick="lancarUso()">Adicionar Insumo</button>
            <hr>
            <label>Venda Total do Dia:</label>
            <input type="number" id="v-total" placeholder="R$ 0,00">
            <button class="btn btn-venda" onclick="lancarVenda()">üìä Calcular Lucro</button>
            <button class="btn btn-whats" onclick="enviarWhatsApp()">üì± Enviar WhatsApp</button>
        </div>

        <div class="painel">
            <h3>üìà An√°lise de Performance</h3>
            <div class="chart-container">
                <canvas id="meuGrafico"></canvas>
            </div>
        </div>
    </div>

    <div class="grid-layout">
        <div class="painel">
            <h3>üì¶ Cadastro de Pre√ßos</h3>
            <input type="text" id="p-nome" placeholder="Produto">
            <div style="display:flex; gap:5px">
                <input type="number" id="p-peso" placeholder="Qtd">
                <select id="p-unidade" style="width:80px"><option value="kg">Kg</option><option value="g">g</option><option value="un">Un</option></select>
            </div>
            <input type="number" id="p-preco" placeholder="Pre√ßo Pago">
            <button class="btn btn-lancar" onclick="cadastrarPreco()">Salvar no Estoque</button>
        </div>
        
        <div class="painel">
            <div style="display:flex; justify-content:space-between">
                <h3>üìù Insumos de Hoje</h3>
                <button onclick="limparDia()" style="color:red; border:none; background:none; cursor:pointer">Zerar Dia</button>
            </div>
            <div id="lista-dia" style="max-height: 200px; overflow-y: auto;">
                <table width="100%" style="border-collapse: collapse;">
                    <tbody id="corpo-dia"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let precosDB = JSON.parse(localStorage.getItem('felipe_precos_v2')) || {};
    let usoDia = JSON.parse(localStorage.getItem('felipe_uso_dia_v2')) || [];
    let faturamentoDia = parseFloat(localStorage.getItem('felipe_faturamento_dia')) || 0;
    let nomeEmpresa = localStorage.getItem('felipe_nome_empresa') || "Churros Pro";
    let meuGrafico;

    const frases = [
        "Vender √© ajudar algu√©m a realizar um desejo!",
        "Churros quentinhos, clientes felizes, bolso cheio.",
        "A persist√™ncia √© o caminho do √™xito.",
        "Trabalhe com amor e o lucro vir√° naturalmente.",
        "Hoje √© um excelente dia para bater recordes de vendas!"
    ];

    function inicializarGrafico() {
        const ctx = document.getElementById('meuGrafico').getContext('2d');
        meuGrafico = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Lucro L√≠quido', 'Custo Insumos'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#00b894', '#d63031'],
                    borderWidth: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function atualizarRelogio() {
        const agora = new Date();
        document.getElementById('data-topo').innerText = agora.toLocaleDateString('pt-br', {weekday: 'long', day: '2-digit', month: '2-digit'}).toUpperCase();
        document.getElementById('hora-topo').innerText = agora.toLocaleTimeString('pt-br');
    }

    function cadastrarPreco() {
        const nome = document.getElementById('p-nome').value;
        const peso = parseFloat(document.getElementById('p-peso').value);
        const preco = parseFloat(document.getElementById('p-preco').value);
        const uni = document.getElementById('p-unidade').value;
        if(!nome || !peso || !preco) return;
        let fator = (uni === 'kg') ? 1000 : 1;
        precosDB[nome] = { precoBase: preco / (peso * fator) };
        localStorage.setItem('felipe_precos_v2', JSON.stringify(precosDB));
        renderTudo();
    }

    function lancarUso() {
        const nome = document.getElementById('u-insumo').value;
        const qtd = parseFloat(document.getElementById('u-qtd').value);
        if(!nome || !qtd) return;
        usoDia.unshift({ nome, qtd, custo: precosDB[nome].precoBase * qtd });
        localStorage.setItem('felipe_uso_dia_v2', JSON.stringify(usoDia));
        renderTudo();
    }

    function lancarVenda() {
        faturamentoDia = parseFloat(document.getElementById('v-total').value) || 0;
        localStorage.setItem('felipe_faturamento_dia', faturamentoDia);
        renderTudo();
    }

    function renderTudo() {
        document.getElementById('nome-empresa').innerText = nomeEmpresa;
        const selectUso = document.getElementById('u-insumo');
        selectUso.innerHTML = "";
        for (let p in precosDB) selectUso.innerHTML += `<option value="${p}">${p}</option>`;
        
        const corpo = document.getElementById('corpo-dia');
        corpo.innerHTML = "";
        let totalCusto = 0;
        usoDia.forEach(item => {
            totalCusto += item.custo;
            corpo.innerHTML += `<tr style="border-bottom:1px solid #eee"><td style="padding:8px">${item.nome}</td><td>${item.qtd}</td><td>R$ ${item.custo.toFixed(2)}</td></tr>`;
        });

        const lucro = faturamentoDia - totalCusto;
        document.getElementById('venda-bruta').innerText = `R$ ${faturamentoDia.toFixed(2)}`;
        document.getElementById('custo-total').innerText = `R$ ${totalCusto.toFixed(2)}`;
        document.getElementById('lucro-real').innerText = `R$ ${lucro.toFixed(2)}`;

        // Atualiza Gr√°fico
        if(meuGrafico) {
            meuGrafico.data.datasets[0].data = [lucro > 0 ? lucro : 0, totalCusto];
            meuGrafico.update();
        }
    }

    function enviarWhatsApp() {
        const totalCusto = usoDia.reduce((acc, item) => acc + item.custo, 0);
        let texto = `üìä *RELAT√ìRIO ${nomeEmpresa}*\nüí∞ *Venda:* R$ ${faturamentoDia.toFixed(2)}\nüìâ *Custo:* R$ ${totalCusto.toFixed(2)}\n‚úÖ *Lucro:* R$ ${(faturamentoDia-totalCusto).toFixed(2)}`;
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(texto)}`, '_blank');
    }

    function limparDia() {
        if(confirm("Zerar dados?")) {
            usoDia = []; faturamentoDia = 0;
            localStorage.setItem('felipe_uso_dia_v2', "[]");
            localStorage.setItem('felipe_faturamento_dia', 0);
            renderTudo();
        }
    }

    window.onload = () => { 
        document.getElementById('frase-motivadora').innerText = `"${frases[Math.floor(Math.random()*frases.length)]}"`;
        atualizarRelogio(); 
        inicializarGrafico();
        renderTudo(); 
    };
    setInterval(atualizarRelogio, 1000);
</script>
</body>
</html>
